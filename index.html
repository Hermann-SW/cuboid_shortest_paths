<!DOCTYPE html>
<html>
<head>

<script type="text/javascript">
const eps=0.00001;

function near(x, x0) {
    return Math.abs(x-x0) < eps;
}

function mult3D(p, v) {
    return p[0]*v[0] + p[1]*v[1] + p[2]*v[2];
}

function cross3D(p, v) {
    return [p[0]*v[0], p[1]*v[1], p[2]*v[2]];
}

function add3D(p, v) {
    return [p[0]+v[0], p[1]+v[1], p[2]+v[2]];
}

function add3D_(p, v, s) {
    return [add3D(p[0],cross3D(v[0], s)), add3D(p[1],cross3D(v[1], s))];
}


function open(w, h) {
    document.write("<svg height=\""+h+"\" width=\""+w+"\">");
}

function polygon(p, sc, x0, y0, v) {
    document.write("  <polygon points=\"");
    p.forEach(function(p) {
        document.write(x0+sc*mult3D(p[0],v),",",y0-sc*mult3D(p[1],v)," ");
    });
    document.write("    \" style=\"fill:lightgrey;stroke:black;stroke-width:1\">");
    document.write("  </polygon>");
}

function polyline(p, sc, x0, y0, col, v) {
    document.write("  <polyline points=\"");
    p.forEach(function(p) {
        document.write(x0+sc*mult3D(p[0],v),",",y0-sc*mult3D(p[1],v)," ");
    });
    document.write("    \" style=\"fill:white;stroke:",col,";stroke-width:1\">");
    document.write("  </polyline>");
}

function circle(p, sc, x0, y0, r, fil, v) {
    document.write("  <circle fill=\"",fil?"black":"none","\" stroke=\"black\" stroke-width=\"1\" cx=\"");
    document.write(x0+sc*mult3D(p[0],v),"\" cy=\"",y0-sc*mult3D(p[1],v),"\" r=\"", sc*r, "\">");
    document.write("  </circle>");
}

function close() {
    document.write("</svg>");
}


var cuboid=[1,2,3];

var fold=[
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,1,0]], [[1,0,0],[0,1,0]], [[1,0,0],[2,2,0]],
   [[1,1,1],[2,2,0]], [[1,1,1],[1,2,0]], [[1,0,1],[1,2,0]], [[1,0,1], [0,0,0]]],
 q:[[1,0,1],[1,2,0]],
 v:[[0,1,0],[1,0,0]],
 f:6
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,1,0]], [[1,0,0],[0,1,0]], [[1,0,0],[1,2,0]],
   [[2,0,1],[1,2,0]], [[2,0,1],[1,1,0]], [[1,0,1],[1,1,0]], [[1,0,1], [0,0,0]]],
 q:[[1,0,1],[1,2,0]],
 v:[[1,0,0],[0,-1,0]],
 f:5
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,1,0]], [[1,0,0],[0,1,0]], [[1,0,0],[1,1,0]],
   [[1,1,1],[1,1,0]], [[1,1,1],[0,1,0]], [[1,0,1],[0,1,0]], [[1,0,1], [0,0,0]]],
 q:[[1,1,1],[1,1,0]],
 v:[[0,-1,0],[-1,0,0]],
 f:4
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,1,0]], [[2,0,1],[0,1,0]], [[2,0,1],[0,0,0]]],
 q:[[2,0,1],[0,0,0]],
 v:[[-1,0,0],[0,1,0]],
 f:3
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,1,0]], [[1,0,1],[0,1,0]], [[1,0,1],[0,0,0]],
   [[1,1,1],[0,0,0]], [[1,1,1],[-1,0,0]], [[1,0,0],[-1,0,0]], [[1,0,0], [0,0,0]]],
 q:[[1,0,1],[-1,0,0]],
 v:[[0,1,0],[1,0,0]],
 f:4
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,1,0]], [[1,0,1],[0,1,0]], [[1,0,1],[-1,0,0]],
   [[2,0,1],[-1,0,0]], [[2,0,1],[-1,-1,0]], [[1,0,0],[-1,-1,0]], [[1,0,0], [0,0,0]]],
 q:[[1,0,1],[-1,0,0]],
 v:[[1,0,0],[0,-1,0]],
 f:5
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,1,0]], [[1,0,1],[0,1,0]], [[1,0,1],[-1,-1,0]],
   [[1,1,1],[-1,-1,0]], [[1,1,1],[-2,-1,0]], [[1,0,0],[-2,-1,0]], [[1,0,0], [0,0,0]]],
 q:[[1,1,1],[-1,-1,0]],
 v:[[0,-1,0],[-1,0,0]],
 f:6
},
{p:[[[0,0,0],[0,0,-1]], [[0,0,0],[0,1,0]], [[1,0,0],[0,1,0]], [[1,0,0],[0,0,0]],
   [[2,2,0],[0,0,0]], [[2,2,0],[-1,0,-1]], [[2,1,0],[-1,0,-1]], [[2,1,0], [0,0,-1]]],
 q:[[2,2,0],[0,0,-1]],
 v:[[0,-1,0],[-1,0,0]],
 f:6
},
{p:[[[0,0,0],[0,0,-1]], [[0,0,0],[0,1,0]], [[1,0,0],[0,1,0]], [[1,0,0],[0,0,0]],
   [[2,1,0],[0,0,0]], [[2,1,0],[0,-1,-1]], [[1,1,0],[0,-1,-1]], [[1,1,0], [0,0,-1]]],
 q:[[2,1,0],[0,-1,-1]],
 v:[[-1,0,0],[0,1,0]],
 f:5
},
{p:[[[0,0,0],[0,0,-1]], [[0,0,0],[0,1,0]], [[1,0,0],[0,1,0]], [[1,0,0],[0,0,0]],
   [[1,1,0],[0,0,0]], [[1,1,0],[-1,0,-1]], [[1,0,0],[-1,0,-1]], [[1,0,0], [0,0,-1]]],
 q:[[1,0,0],[-1,0,-1]],
 v:[[0,1,0],[1,0,0]],
 f:4
},
{p:[[[0,0,0],[0,-1,-1]], [[0,0,0],[0,1,0]], [[1,0,0],[0,1,0]], [[1,0,0],[0,-1,-1]]],
 q:[[0,0,0],[0,0,-1]],
 v:[[1,0,0],[0,-1,0]],
 f:3
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,1,0]], [[1,0,0],[0,1,0]], [[1,0,0],[0,0,-1]],
   [[0,0,0],[0,0,-1]], [[0,0,0],[-1,0,-1]], [[0,-1,0],[-1,0,-1]], [[0,-1,0], [0,0,0]]],
 q:[[0,0,0],[0,0,-1]],
 v:[[0,-1,0],[-1,0,0]],
 f:4
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,1,0]], [[1,0,0],[0,1,0]], [[1,0,0],[0,0,-1]],
   [[0,-1,0],[0,0,-1]], [[0,-1,0],[0,-1,-1]], [[-1,-1,0],[0,-1,-1]], [[-1,-1,0], [0,0,0]]],
 q:[[0,-1,0],[0,-1,-1]],
 v:[[-1,0,0],[0,1,0]],
 f:5
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,1,0]], [[1,0,0],[0,1,0]], [[1,0,0],[0,0,-1]],
   [[-1,-1,0],[0,0,-1]], [[-1,-1,0],[-1,0,-1]], [[-1,-2,0],[-1,0,-1]], [[-1,-2,0], [0,0,0]]],
 q:[[-1,-2,0],[-1,0,-1]],
 v:[[0,1,0],[1,0,0]],
 f:6
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[-2,-1,0]], [[0,-1,-1],[-2,-1,0]], [[0,-1,-1],[-1,-1,0]],
   [[0,0,-1],[-1,-1,0]], [[0,0,-1],[0,1,0]], [[1,0,0],[0,1,0]], [[1,0,0], [0,0,0]]],
 q:[[0,-1,-1],[-2,-1,0]],
 v:[[0,1,0],[1,0,0]],
 f:6
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[-1,-1,0]], [[-1,0,-1],[-1,-1,0]], [[-1,0,-1],[-1,0,0]],
   [[0,0,-1],[-1,0,0]], [[0,0,-1],[0,1,0]], [[1,0,0],[0,1,0]], [[1,0,0], [0,0,0]]],
 q:[[-1,0,-1],[-1,0,0]],
 v:[[1,0,0],[0,-1,0]],
 f:5
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[-1,0,0]], [[0,-1,-1],[-1,0,0]], [[0,-1,-1],[0,0,0]],
   [[0,0,-1],[0,0,0]], [[0,0,-1],[0,1,0]], [[1,0,0],[0,1,0]], [[1,0,0], [0,0,0]]],
 q:[[0,0,-1],[0,0,0]],
 v:[[0,-1,0],[-1,0,0]],
 f:4
},
{p:[[[1,0,0],[0,0,0]], [[-1,0,-1],[0,0,0]], [[-1,0,-1],[0,1,0]], [[1,0,0],[0,1,0]]],
 q:[[0,0,-1],[0,0,0]],
 v:[[-1,0,0],[0,1,0]],
 f:3
},
{p:[[[1,0,0],[0,0,0]], [[0,0,-1],[0,0,0]], [[0,0,-1],[0,1,0]], [[0,-1,-1],[0,1,0]],
   [[0,-1,-1],[1,1,0]], [[0,0,0],[1,1,0]], [[0,0,0],[0,1,0]], [[1,0,0], [0,1,0]]],
 q:[[0,-1,-1],[0,1,0]],
 v:[[0,1,0],[1,0,0]],
 f:4
},
{p:[[[1,0,0],[0,0,0]], [[0,0,-1],[0,0,0]], [[0,0,-1],[1,1,0]], [[-1,0,-1],[1,1,0]],
   [[-1,0,-1],[1,2,0]], [[0,0,0],[1,2,0]], [[0,0,0],[0,1,0]], [[1,0,0], [0,1,0]]],
 q:[[-1,0,-1],[1,2,0]],
 v:[[1,0,0],[0,-1,0]],
 f:5
},
{p:[[[1,0,0],[0,0,0]], [[0,0,-1],[0,0,0]], [[0,0,-1],[1,2,0]], [[0,-1,-1],[1,2,0]],
   [[0,-1,-1],[2,2,0]], [[0,0,0],[2,2,0]], [[0,0,0],[0,1,0]], [[1,0,0], [0,1,0]]],
 q:[[0,0,-1],[2,2,0]],
 v:[[0,-1,0],[-1,0,0]],
 f:6
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,1,0]], [[-1,-2,0],[0,1,0]], [[-1,-2,0],[1,1,1]],
   [[-1,-1,0],[1,1,1]], [[-1,-1,0],[0,1,1]], [[1,0,0],[0,1,1]], [[1,0,0], [0,0,0]]],
 q:[[-1,-1,0],[1,1,1]],
 v:[[0,-1,0],[-1,0,0]],
 f:6
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,1,0]], [[-1,-1,0],[0,1,0]], [[-1,-1,0],[0,2,1]],
   [[0,-1,0],[0,2,1]], [[0,-1,0],[0,1,1]], [[1,0,0],[0,1,1]], [[1,0,0], [0,0,0]]],
 q:[[0,-1,0],[0,1,1]],
 v:[[-1,0,0],[0,1,0]],
 f:5
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,1,0]], [[0,-1,0],[0,1,0]], [[0,-1,0],[1,1,1]],
   [[0,0,0],[1,1,1]], [[0,0,0],[0,1,1]], [[1,0,0],[0,1,1]], [[1,0,0], [0,0,0]]],
 q:[[0,-1,0],[0,1,1]],
 v:[[0,1,0],[1,0,0]],
 f:4
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,2,1]], [[1,0,0],[0,2,1]], [[1,0,0],[0,0,0]]],
 q:[[0,0,0],[0,2,1]],
 v:[[1,0,0],[0,-1,0]],
 f:3
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,1,1]], [[1,0,0],[0,1,1]], [[1,0,0],[1,1,1]],
   [[1,1,0],[1,1,1]], [[1,1,0],[0,1,0]], [[1,0,0],[0,1,0]], [[1,0,0], [0,0,0]]],
 q:[[1,1,0],[1,1,1]],
 v:[[0,-1,0],[-1,0,0]],
 f:4
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,1,1]], [[1,1,0],[0,1,1]], [[1,1,0],[0,2,1]],
   [[2,1,0],[0,2,1]], [[2,1,0],[0,1,0]], [[1,0,0],[0,1,0]], [[1,0,0], [0,0,0]]],
 q:[[2,1,0],[0,1,1]],
 v:[[-1,0,0],[0,1,0]],
 f:5
},
{p:[[[0,0,0],[0,0,0]], [[0,0,0],[0,1,1]], [[2,1,0],[0,1,1]], [[2,1,0],[1,1,1]],
   [[2,2,0],[1,1,1]], [[2,2,0],[0,1,0]], [[1,0,0],[0,1,0]], [[1,0,0], [0,0,0]]],
 q:[[2,1,0],[0,1,1]],
 v:[[0,1,0],[1,0,0]],
 f:6
},
];

var max={x:0,y:0};
var min={x:0,y:0};
fold.forEach(function(s) {
    s.p.forEach(function([x,y]) {
        max.x = Math.max(max.x, mult3D(x, cuboid));
        max.y = Math.max(max.y, mult3D(y, cuboid));
        min.x = Math.min(min.x, mult3D(x, cuboid));
        min.y = Math.min(min.y, mult3D(y, cuboid));
    });
});

var sc = 500/Math.max(max.x, max.y);

function show(s) {
    var mi={x:0,y:0};
    var ma={x:0,y:0};
    fold[s].p.forEach(function([x,y]) {
        ma.x = Math.max(ma.x, mult3D(x, cuboid));
        ma.y = Math.max(ma.y, mult3D(y, cuboid));
        mi.x = Math.min(mi.x, mult3D(x, cuboid));
        mi.y = Math.min(mi.y, mult3D(y, cuboid));
    });
    var ox=(0.2 - mi.x)*sc;
    var oy=(0.2 + ma.y)*sc;

    var fs1=[[0.5,0.3333,0],[0.5,0.6666,0]];
    var fs2=[[0.3333,0.25,0],[0.3333,0.5,0],[0.3333,0.75,0],
             [0.6666,0.25,0],[0.6666,0.5,0],[0.6666,0.75,0]];

    document.open();
    document.write('<html><body><input type="range" min="0" max="27" value="',
                   s,'" id="s" onInput="javascript:doi()"><br>');
    document.write('Cuboid folding ',s,';');
    document.write(' shortest paths passing ', fold[s].f, ' cuboid faces.<br>');

    open((max.x-min.x+0.4)*sc, (max.y-min.y+0.4)*sc);
     polygon(fold[s].p, sc, ox, oy, cuboid);
     circle([[0,0,0],[0,0,0]], sc, ox, oy, 0.1, true, cuboid); 
     fs1.forEach(function(f) {
         circle([cross3D([1,0,0],f),cross3D([0,1,0],f)], sc, ox, oy, 0.05, true, cuboid); 
     });
     circle(fold[s].q, sc, ox, oy, 0.1, false, cuboid); 
     fs2.forEach(function(f) {
         circle(add3D_(fold[s].q,fold[s].v,f), sc, ox, oy, 0.05, false, cuboid);
     });

     if (near(s,19)) {
         polyline([[[0.2/cuboid[0],0,0],[0,1.45/cuboid[1],0]],
                   add3D_(fold[s].q,fold[s].v,[0.9/cuboid[0],1.7/cuboid[1],0])],
                  sc, ox, oy, "yellow", cuboid);
     }
    close();

    document.write('</body></html>');

    document.getElementById("s").focus();
}

function doi(s) {
    show(document.getElementById("s").value);
}

show(19);
</script>

</head>
<body>

</body>
</html>
